---
import Layout from './Layout.astro';
import ThemeToggle from '../components/ThemeToggle.svelte';

interface Props {
  title: string;
  description?: string;
  activeSection?: string;
}

const { title, description, activeSection } = Astro.props;

// Navigation structure
const navSections = [
  {
    title: 'Getting Started',
    items: [
      { href: '/docs', label: 'Overview', slug: 'overview' },
      { href: '/docs/library', label: 'Library', slug: 'library' },
    ]
  },
  {
    title: 'Agents',
    items: [
      { href: '/docs/agents', label: 'Agent Architecture', slug: 'agents' },
      { href: '/docs/agents/sifter', label: 'Sifter (Orchestrator)', slug: 'sifter' },
      { href: '/docs/agents/researcher', label: 'Researcher', slug: 'researcher' },
      { href: '/docs/agents/analyzer', label: 'Analyzer', slug: 'analyzer' },
      { href: '/docs/agents/translator', label: 'Translator', slug: 'translator' },
      { href: '/docs/agents/narrator', label: 'Narrator', slug: 'narrator' },
      { href: '/docs/agents/memory', label: 'Memory', slug: 'memory' },
      { href: '/docs/agents/librarian', label: 'Librarian', slug: 'librarian' },
      { href: '/docs/agents/transcriber', label: 'Transcriber', slug: 'transcriber' },
    ]
  },
  {
    title: 'API Reference',
    items: [
      { href: '/docs/api', label: 'Public API', slug: 'api' },
    ]
  }
];
---

<Layout title={`${title} - SifterSearch Docs`} description={description}>
  <div class="docs-layout">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <button class="menu-toggle" id="menu-toggle" aria-label="Toggle menu">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 12h18M3 6h18M3 18h18"/>
          </svg>
        </button>
        <a href="/" class="logo-link">
          <img src="/ocean.svg" alt="SifterSearch" class="logo" />
          <span class="site-title">SifterSearch</span>
          <span class="docs-badge">Docs</span>
        </a>
      </div>
      <nav class="header-nav">
        <ThemeToggle client:only="svelte" />
        <a href="/about" class="nav-link">About</a>
        <a href="/" class="nav-link">Search</a>
      </nav>
    </header>

    <div class="main-container">
      <!-- Sidebar -->
      <aside class="sidebar" id="sidebar">
        <nav class="sidebar-nav">
          {navSections.map((section) => (
            <div class="nav-section">
              <h3 class="nav-section-title">{section.title}</h3>
              <ul class="nav-list">
                {section.items.map((item) => (
                  <li>
                    <a
                      href={item.href}
                      class:list={['nav-item', { active: activeSection === item.slug }]}
                    >
                      {item.label}
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          ))}
        </nav>
      </aside>

      <!-- Main Content -->
      <main class="content">
        <article class="article">
          <slot />
        </article>

        <!-- Footer -->
        <footer class="footer">
          <p>&copy; {new Date().getFullYear()} Chad Jones. A companion tool for <a href="https://oceanlibrary.com" class="footer-link">OceanLibrary.com</a>.</p>
        </footer>
      </main>
    </div>
  </div>
</Layout>

<script>
  // Mobile menu toggle
  const menuToggle = document.getElementById('menu-toggle');
  const sidebar = document.getElementById('sidebar');

  menuToggle?.addEventListener('click', () => {
    sidebar?.classList.toggle('open');
  });

  // Close sidebar when clicking outside on mobile
  document.addEventListener('click', (e) => {
    if (window.innerWidth < 1024 &&
        sidebar?.classList.contains('open') &&
        !sidebar.contains(e.target as Node) &&
        e.target !== menuToggle) {
      sidebar.classList.remove('open');
    }
  });
</script>

<style>
  .docs-layout {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    background-color: var(--surface-0);
  }

  /* Header */
  .header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 1rem;
    height: 3.5rem;
    border-bottom: 1px solid var(--border-default);
    background-color: var(--surface-0);
    position: sticky;
    top: 0;
    z-index: 100;
  }

  .header-left {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .menu-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2rem;
    height: 2rem;
    padding: 0;
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    border-radius: 0.375rem;
  }

  .menu-toggle:hover {
    background-color: var(--surface-1);
    color: var(--text-primary);
  }

  @media (min-width: 1024px) {
    .menu-toggle {
      display: none;
    }
  }

  .logo-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    text-decoration: none;
    color: inherit;
  }

  .logo {
    width: 1.75rem;
    height: 1.75rem;
    border-radius: 0.375rem;
  }

  .site-title {
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-primary);
  }

  .docs-badge {
    font-size: 0.625rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--accent-primary);
    background-color: color-mix(in srgb, var(--accent-primary) 15%, transparent);
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem;
  }

  .header-nav {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .nav-link {
    font-size: 0.875rem;
    color: var(--text-secondary);
    text-decoration: none;
    transition: color 0.15s;
  }

  .nav-link:hover {
    color: var(--text-primary);
  }

  /* Main Container */
  .main-container {
    display: flex;
    flex: 1;
  }

  /* Sidebar */
  .sidebar {
    width: 16rem;
    flex-shrink: 0;
    border-right: 1px solid var(--border-default);
    background-color: var(--surface-0);
    overflow-y: auto;
    height: calc(100vh - 3.5rem);
    position: sticky;
    top: 3.5rem;
  }

  @media (max-width: 1023px) {
    .sidebar {
      position: fixed;
      top: 3.5rem;
      left: 0;
      bottom: 0;
      z-index: 50;
      transform: translateX(-100%);
      transition: transform 0.2s ease;
      box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
    }

    .sidebar.open {
      transform: translateX(0);
    }
  }

  .sidebar-nav {
    padding: 1rem 0;
  }

  .nav-section {
    margin-bottom: 1.5rem;
  }

  .nav-section-title {
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-muted);
    padding: 0 1rem;
    margin-bottom: 0.5rem;
  }

  .nav-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .nav-item {
    display: block;
    font-size: 0.875rem;
    color: var(--text-secondary);
    text-decoration: none;
    padding: 0.5rem 1rem;
    border-left: 2px solid transparent;
    transition: all 0.15s;
  }

  .nav-item:hover {
    color: var(--text-primary);
    background-color: var(--surface-1);
  }

  .nav-item.active {
    color: var(--accent-primary);
    background-color: color-mix(in srgb, var(--accent-primary) 10%, transparent);
    border-left-color: var(--accent-primary);
    font-weight: 500;
  }

  /* Content */
  .content {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
  }

  .article {
    flex: 1;
    padding: 2rem 1.5rem;
    max-width: 48rem;
    margin: 0 auto;
    width: 100%;
  }

  @media (min-width: 768px) {
    .article {
      padding: 3rem 2rem;
    }
  }

  /* Footer */
  .footer {
    text-align: center;
    padding: 2rem 1rem;
    font-size: 0.875rem;
    color: var(--text-muted);
    border-top: 1px solid var(--border-default);
  }

  .footer-link {
    color: var(--text-secondary);
    text-decoration: none;
  }

  .footer-link:hover {
    color: var(--text-primary);
  }

  /* Prose Styling (for markdown content) */
  .article :global(h1) {
    font-size: 2rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
    line-height: 1.2;
  }

  .article :global(.subtitle) {
    font-size: 1.125rem;
    color: var(--text-secondary);
    margin-bottom: 2rem;
  }

  .article :global(h2) {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-top: 2.5rem;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid var(--border-default);
  }

  .article :global(h3) {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-top: 2rem;
    margin-bottom: 0.75rem;
  }

  .article :global(h4) {
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-top: 1.5rem;
    margin-bottom: 0.5rem;
  }

  .article :global(p) {
    color: var(--text-secondary);
    line-height: 1.7;
    margin-bottom: 1rem;
  }

  .article :global(ul),
  .article :global(ol) {
    margin-bottom: 1rem;
    padding-left: 1.5rem;
    color: var(--text-secondary);
  }

  .article :global(li) {
    margin-bottom: 0.5rem;
    line-height: 1.6;
  }

  .article :global(code) {
    font-family: 'Fira Code', 'Consolas', monospace;
    font-size: 0.875em;
    background-color: var(--surface-elevated);
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem;
    color: var(--accent-secondary);
  }

  .article :global(pre) {
    background-color: var(--surface-elevated);
    border: 1px solid var(--border-default);
    border-radius: 0.5rem;
    padding: 1rem;
    overflow-x: auto;
    margin-bottom: 1.5rem;
  }

  .article :global(pre code) {
    background: none;
    padding: 0;
    color: var(--text-primary);
    font-size: 0.8rem;
    line-height: 1.6;
  }

  .article :global(a) {
    color: var(--accent-primary);
    text-decoration: none;
  }

  .article :global(a:hover) {
    text-decoration: underline;
  }

  .article :global(strong) {
    color: var(--text-primary);
    font-weight: 600;
  }

  .article :global(hr) {
    border: none;
    border-top: 1px solid var(--border-default);
    margin: 2rem 0;
  }

  .article :global(table) {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 1.5rem;
    font-size: 0.875rem;
  }

  .article :global(th),
  .article :global(td) {
    padding: 0.75rem;
    text-align: left;
    border: 1px solid var(--border-default);
  }

  .article :global(th) {
    background-color: var(--surface-1);
    font-weight: 600;
    color: var(--text-primary);
  }

  .article :global(td) {
    color: var(--text-secondary);
  }

  .article :global(blockquote) {
    border-left: 3px solid var(--accent-primary);
    padding-left: 1rem;
    margin: 1.5rem 0;
    color: var(--text-secondary);
    font-style: italic;
  }

  /* Callout boxes */
  .article :global(.callout) {
    padding: 1rem;
    border-radius: 0.5rem;
    margin: 1.5rem 0;
  }

  .article :global(.callout-info) {
    background-color: color-mix(in srgb, var(--accent-primary) 10%, transparent);
    border: 1px solid color-mix(in srgb, var(--accent-primary) 30%, transparent);
  }

  .article :global(.callout-warning) {
    background-color: color-mix(in srgb, var(--warning) 10%, transparent);
    border: 1px solid color-mix(in srgb, var(--warning) 30%, transparent);
  }
</style>
