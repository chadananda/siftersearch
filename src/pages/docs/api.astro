---
import DocsLayout from '../../layouts/DocsLayout.astro';
---

<DocsLayout
  title="Public API Reference"
  description="REST API documentation for integrating SifterSearch into your applications"
  activeSection="api"
>
  <h1>Public Search API</h1>
  <p class="subtitle">Integrate AI-powered sacred text search into your applications</p>

  <p>
    The SifterSearch Public API provides programmatic access to our hybrid search system with
    full AI analysis, scoring, and highlighting. Use it to build custom search interfaces,
    research tools, or integrate sacred text search into your own applications.
  </p>

  <h2>Authentication</h2>

  <p>All API requests require an API key passed in the <code>X-API-Key</code> header.</p>

  <pre><code>curl -X POST https://api.siftersearch.com/api/v1/search \
  -H "Content-Type: application/json" \
  -H "X-API-Key: your-api-key-here" \
  -d '&#123;"query": "what is justice"&#125;'</code></pre>

  <p>
    To request an API key, contact us at <a href="mailto:api@siftersearch.com">api@siftersearch.com</a>.
    Include your intended use case and expected request volume.
  </p>

  <h2>Rate Limits</h2>

  <table>
    <thead>
      <tr>
        <th>Tier</th>
        <th>Requests/Hour</th>
        <th>Max Results</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Standard</td>
        <td>1,000</td>
        <td>50</td>
      </tr>
      <tr>
        <td>Premium</td>
        <td>10,000</td>
        <td>100</td>
      </tr>
    </tbody>
  </table>

  <p>Rate limit headers are included in every response:</p>
  <ul>
    <li><code>X-RateLimit-Limit</code> - Maximum requests per hour</li>
    <li><code>X-RateLimit-Remaining</code> - Requests remaining in current window</li>
    <li><code>X-RateLimit-Reset</code> - Unix timestamp when the window resets</li>
  </ul>

  <hr />

  <h2>Endpoints</h2>

  <h3>POST /api/v1/search</h3>
  <p>
    Full hybrid search with AI-powered analysis. Returns scored, highlighted results
    with brief summaries. Best for detailed research queries.
  </p>

  <h4>Request Body</h4>
  <table>
    <thead>
      <tr>
        <th>Field</th>
        <th>Type</th>
        <th>Required</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>query</code></td>
        <td>string</td>
        <td>Yes</td>
        <td>Search query (1-500 characters)</td>
      </tr>
      <tr>
        <td><code>limit</code></td>
        <td>integer</td>
        <td>No</td>
        <td>Max results to return (1-50, default: 10)</td>
      </tr>
      <tr>
        <td><code>filters</code></td>
        <td>object</td>
        <td>No</td>
        <td>Filter criteria (see below)</td>
      </tr>
    </tbody>
  </table>

  <h4>Filter Options</h4>
  <table>
    <thead>
      <tr>
        <th>Field</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>religion</code></td>
        <td>string</td>
        <td>Filter by religion (e.g., "Baha'i", "Buddhism")</td>
      </tr>
      <tr>
        <td><code>collection</code></td>
        <td>string</td>
        <td>Filter by collection (e.g., "Pilgrim Notes")</td>
      </tr>
      <tr>
        <td><code>yearFrom</code></td>
        <td>integer</td>
        <td>Minimum publication year</td>
      </tr>
      <tr>
        <td><code>yearTo</code></td>
        <td>integer</td>
        <td>Maximum publication year</td>
      </tr>
    </tbody>
  </table>

  <h4>Example Request</h4>
  <pre><code>POST /api/v1/search
Content-Type: application/json
X-API-Key: your-api-key

&#123;
  "query": "meaning of prayer and meditation",
  "limit": 5,
  "filters": &#123;
    "religion": "Baha'i"
  &#125;
&#125;</code></pre>

  <h4>Example Response</h4>
  <pre><code>&#123;
  "results": [
    &#123;
      "id": "1907_07_martha_root_reflections_p42",
      "documentId": "1907_07_martha_root_reflections",
      "paragraphIndex": 42,
      "text": "Prayer and supplication are two wings whereby man soars...",
      "highlightedText": "&lt;mark&gt;Prayer and supplication&lt;/mark&gt; are two wings...",
      "title": "Reflections on Prayer and Contemplation",
      "author": "Martha Root",
      "religion": "Baha'i",
      "collection": "Pilgrim Notes",
      "score": 92,
      "summary": "Prayer enables spiritual ascent"
    &#125;
  ],
  "query": "meaning of prayer and meditation",
  "totalFound": 47,
  "processingTimeMs": 1234
&#125;</code></pre>

  <hr />

  <h3>POST /api/v1/search/quick</h3>
  <p>
    Fast keyword-only search without AI analysis. Returns raw Meilisearch results with
    word-level highlighting. Best for autocomplete, typeahead, or high-volume queries.
  </p>

  <h4>Request Body</h4>
  <table>
    <thead>
      <tr>
        <th>Field</th>
        <th>Type</th>
        <th>Required</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>query</code></td>
        <td>string</td>
        <td>Yes</td>
        <td>Search query (1-200 characters)</td>
      </tr>
      <tr>
        <td><code>limit</code></td>
        <td>integer</td>
        <td>No</td>
        <td>Max results (1-50, default: 10)</td>
      </tr>
      <tr>
        <td><code>filters</code></td>
        <td>object</td>
        <td>No</td>
        <td>Filter by religion or collection</td>
      </tr>
    </tbody>
  </table>

  <h4>Example Response</h4>
  <pre><code>&#123;
  "results": [
    &#123;
      "id": "hidden_words_p23",
      "text": "The light of men is &lt;mark&gt;Justice&lt;/mark&gt;...",
      "title": "Hidden Words",
      "author": "Baha'u'llah",
      "religion": "Baha'i",
      "collection": "Core Publications",
      "score": 0.98
    &#125;
  ],
  "query": "justice",
  "processingTimeMs": 6
&#125;</code></pre>

  <hr />

  <h3>GET /api/v1/collections</h3>
  <p>
    List available religions and collections in the library. Useful for building filter UIs.
  </p>

  <h4>Example Response</h4>
  <pre><code>&#123;
  "religions": ["Baha'i", "Buddhism", "Christianity", "Hinduism", "Islam", "Judaism"],
  "collections": ["Core Publications", "Pilgrim Notes", "Letters", "Talks"],
  "totalDocuments": 12847,
  "lastUpdated": "2024-12-14T00:00:00Z"
&#125;</code></pre>

  <hr />

  <h3>GET /api/v1/health</h3>
  <p>API health check. Does not require authentication.</p>

  <h4>Example Response</h4>
  <pre><code>&#123;
  "status": "ok",
  "version": "1.0.0",
  "timestamp": "2024-12-14T22:52:43.717Z"
&#125;</code></pre>

  <hr />

  <h2>Error Responses</h2>

  <p>All errors return a JSON object with <code>error</code> and <code>code</code> fields:</p>

  <pre><code>&#123;
  "error": "API key required. Set X-API-Key header.",
  "code": "unauthorized"
&#125;</code></pre>

  <h4>Error Codes</h4>
  <table>
    <thead>
      <tr>
        <th>HTTP Status</th>
        <th>Code</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>400</td>
        <td><code>bad_request</code></td>
        <td>Invalid request body or parameters</td>
      </tr>
      <tr>
        <td>401</td>
        <td><code>unauthorized</code></td>
        <td>Missing or invalid API key</td>
      </tr>
      <tr>
        <td>403</td>
        <td><code>forbidden</code></td>
        <td>API key lacks required permissions</td>
      </tr>
      <tr>
        <td>429</td>
        <td><code>rate_limit_exceeded</code></td>
        <td>Too many requests, try again later</td>
      </tr>
      <tr>
        <td>500</td>
        <td><code>internal_error</code></td>
        <td>Server error, please report</td>
      </tr>
    </tbody>
  </table>

  <hr />

  <h2>SDKs & Libraries</h2>

  <p>Official SDKs are coming soon. In the meantime, use any HTTP client:</p>

  <h4>JavaScript / Node.js</h4>
  <pre><code>const response = await fetch('https://api.siftersearch.com/api/v1/search', &#123;
  method: 'POST',
  headers: &#123;
    'Content-Type': 'application/json',
    'X-API-Key': process.env.SIFTER_API_KEY
  &#125;,
  body: JSON.stringify(&#123;
    query: 'what is the purpose of life',
    limit: 10
  &#125;)
&#125;);

const data = await response.json();
console.log(data.results);</code></pre>

  <h4>Python</h4>
  <pre><code>import requests

response = requests.post(
    'https://api.siftersearch.com/api/v1/search',
    headers=&#123;
        'Content-Type': 'application/json',
        'X-API-Key': os.environ['SIFTER_API_KEY']
    &#125;,
    json=&#123;
        'query': 'what is the purpose of life',
        'limit': 10
    &#125;
)

data = response.json()
for result in data['results']:
    print(f"&#123;result['title']&#125;: &#123;result['summary']&#125;")</code></pre>

  <h4>cURL</h4>
  <pre><code>curl -X POST https://api.siftersearch.com/api/v1/search \
  -H "Content-Type: application/json" \
  -H "X-API-Key: $SIFTER_API_KEY" \
  -d '&#123;"query": "what is the purpose of life", "limit": 10&#125;'</code></pre>

  <hr />

  <h2>Best Practices</h2>

  <ul>
    <li><strong>Use semantic queries</strong> - Ask questions naturally: "What does Buddhism teach about suffering?" works better than just "Buddhism suffering".</li>
    <li><strong>Filter when possible</strong> - If you know the tradition, use the religion filter to improve relevance.</li>
    <li><strong>Cache responses</strong> - Results for the same query don't change frequently. Cache for better performance.</li>
    <li><strong>Handle rate limits gracefully</strong> - Check the <code>X-RateLimit-Remaining</code> header and implement backoff.</li>
    <li><strong>Use /search/quick for autocomplete</strong> - The quick endpoint is ~10x faster for simple keyword matches.</li>
  </ul>
</DocsLayout>
