---
import Layout from '../layouts/Layout.astro';
import NavBar from '../components/common/NavBar.svelte';
import changelog from '../lib/changelog.json';

const APP_VERSION = import.meta.env.PUBLIC_APP_VERSION || '0.0.1';

// Group entries by date
const entriesByDate = changelog.entries.reduce((acc, entry) => {
  if (!acc[entry.date]) acc[entry.date] = [];
  acc[entry.date].push(entry);
  return acc;
}, {} as Record<string, typeof changelog.entries>);

const sortedDates = Object.keys(entriesByDate).sort((a, b) => b.localeCompare(a));

// Type badge colors
const typeColors: Record<string, string> = {
  'New': 'bg-green-500/20 text-green-400 border-green-500/30',
  'Fixed': 'bg-blue-500/20 text-blue-400 border-blue-500/30',
  'Changed': 'bg-yellow-500/20 text-yellow-400 border-yellow-500/30',
  'Removed': 'bg-red-500/20 text-red-400 border-red-500/30',
  'Security': 'bg-purple-500/20 text-purple-400 border-purple-500/30',
  'Deprecated': 'bg-orange-500/20 text-orange-400 border-orange-500/30',
};
---

<Layout title="Version History - SifterSearch">
  <NavBar client:load currentPage="changelog" />

  <main class="min-h-screen pt-16 pb-12 px-4">
    <div class="max-w-2xl mx-auto">
      <header class="mb-8 text-center">
        <h1 class="text-2xl font-bold text-primary mb-2">Version History</h1>
        <p class="text-secondary">Current version: <span class="font-mono text-accent">{APP_VERSION}</span></p>
      </header>

      <div class="space-y-6">
        {sortedDates.map((date) => (
          <section class="bg-surface-1-alpha backdrop-blur-lg rounded-xl border border-border p-4">
            <h2 class="text-sm font-semibold text-muted mb-3 uppercase tracking-wide">
              {new Date(date + 'T00:00:00').toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
              })}
            </h2>
            <ul class="space-y-2">
              {entriesByDate[date].map((entry) => (
                <li class="flex items-start gap-3">
                  <span class={`text-xs px-2 py-0.5 rounded border font-medium shrink-0 ${typeColors[entry.type] || 'bg-gray-500/20 text-gray-400 border-gray-500/30'}`}>
                    {entry.type}
                  </span>
                  <span class="text-primary text-sm">{entry.description}</span>
                </li>
              ))}
            </ul>
          </section>
        ))}
      </div>

      <footer class="mt-8 text-center text-sm text-muted">
        <p>Generated from git commit history</p>
      </footer>
    </div>
  </main>
</Layout>
