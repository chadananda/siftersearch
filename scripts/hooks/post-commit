#!/bin/bash

# Post-commit hook for SifterSearch
# Simply pushes to GitHub after successful commit
# This triggers the server auto-update (server polls git every 5 min,
# or client triggers immediate update on version mismatch)

set -e

# Colors
GREEN='\033[0;32m'
BLUE='\033[0;34m'
NC='\033[0m'

# Check if we should skip
if [ "$SKIP_PUSH" = "1" ]; then
  echo -e "${BLUE}[post-commit]${NC} SKIP_PUSH=1, skipping git push"
  exit 0
fi

# Get the root of the git repository
ROOT_DIR=$(git rev-parse --show-toplevel)
cd "$ROOT_DIR"

# Push to origin
echo -e "${BLUE}[post-commit]${NC} Pushing to GitHub..."
if git push origin main 2>&1; then
  echo -e "${GREEN}[post-commit]${NC} âœ“ Pushed to GitHub"
  echo -e "${GREEN}[post-commit]${NC} Server will auto-update within 5 minutes"
  echo -e "${GREEN}[post-commit]${NC} (or immediately when client detects version mismatch)"
else
  echo -e "${BLUE}[post-commit]${NC} Push failed - you may need to push manually"
fi
